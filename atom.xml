<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>RiverFun</title>
  
  <subtitle>技不如人，也绝不甘拜下风！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-07-15T13:30:42.315Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>RiverFun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>-多项式-NTT/FFT- 多项式板子合集</title>
    <link href="http://yoursite.com/2019/07/10/92/"/>
    <id>http://yoursite.com/2019/07/10/92/</id>
    <published>2019-07-10T11:01:15.000Z</published>
    <updated>2019-07-15T13:30:42.315Z</updated>
    
    <content type="html"><![CDATA[<p>下面是多项式的一些操作，包含了NTT，求逆，求 $\ln$，求导，求积分，求 $e^x$，开根，快速幂，三角函数和反三角函数。</p><p><del>多项式除法先咕着</del></p><a id="more"></a><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 400010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOD 998244353</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> G 3</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> I 86583718</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;x)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> f = <span class="hljs-number">1</span>;</span><br><span class="line">    x = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">char</span> c = getchar();</span><br><span class="line">    <span class="hljs-keyword">while</span> (c &lt; <span class="hljs-string">'0'</span> || c &gt; <span class="hljs-string">'9'</span>) &#123;<span class="hljs-keyword">if</span> (c == <span class="hljs-string">'-'</span>) f = <span class="hljs-number">-1</span>; c = getchar();&#125;</span><br><span class="line">    <span class="hljs-keyword">while</span> (c &gt;= <span class="hljs-string">'0'</span> &amp;&amp; c &lt;= <span class="hljs-string">'9'</span>) &#123;x = x * <span class="hljs-number">10</span> + c - <span class="hljs-string">'0'</span>; c = getchar();&#125;</span><br><span class="line">    x *= f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'-'</span>);</span><br><span class="line">        x = -x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">9</span>) write(x / <span class="hljs-number">10</span>);</span><br><span class="line">    <span class="hljs-built_in">putchar</span>(x % <span class="hljs-number">10</span> + <span class="hljs-string">'0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">qpow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> res = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>) res = (<span class="hljs-number">1L</span>L * res * a) % MOD;</span><br><span class="line">        b &gt;&gt;= <span class="hljs-number">1</span>;</span><br><span class="line">        a = (<span class="hljs-number">1L</span>L * a * a) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> res % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> n, m;</span><br><span class="line"><span class="hljs-keyword">int</span> a[MAXN], b[MAXN], f[MAXN], rev[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ntt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-number">1L</span>L * i &lt; rev[i]) &#123;</span><br><span class="line">            <span class="hljs-built_in">std</span>::swap(a[i], a[rev[i]]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i &lt;&lt;= <span class="hljs-number">1</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> wn = qpow(G, (MOD - <span class="hljs-number">1</span>) / ((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)i &lt;&lt; <span class="hljs-number">1</span>));</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j += ((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)i &lt;&lt; <span class="hljs-number">1</span>)) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> w = <span class="hljs-number">1L</span>L;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; i; ++k, w = <span class="hljs-number">1L</span>L * w * wn % MOD) &#123;</span><br><span class="line">                <span class="hljs-keyword">int</span> x = a[j + k], y = <span class="hljs-number">1L</span>L * w * a[j + k + i] % MOD;</span><br><span class="line">                a[j + k] = (x + y) % MOD, a[j + k + i] = (x - y + MOD) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (f == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> tmp = qpow(n, MOD - <span class="hljs-number">2</span>);</span><br><span class="line">    <span class="hljs-built_in">std</span>::reverse(a + <span class="hljs-number">1</span>, a + n);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        a[i] = <span class="hljs-number">1L</span>L * a[i] * tmp % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> c[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">inv</span><span class="hljs-params">(<span class="hljs-keyword">int</span> d, <span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (d == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">        b[<span class="hljs-number">0</span>] = qpow(a[<span class="hljs-number">0</span>], MOD - <span class="hljs-number">2</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inv((d + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>, a, b);</span><br><span class="line">    <span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>, _n = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (_n &lt; (d &lt;&lt; <span class="hljs-number">1</span>)) _n &lt;&lt;= <span class="hljs-number">1</span>, l++;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | (((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)i &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) c[i] = a[i];</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = d; i &lt; _n; i++) c[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    ntt(c, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    ntt(b, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        b[i] = (<span class="hljs-number">2</span> - <span class="hljs-number">1L</span>L * b[i] * c[i] % MOD + MOD) % MOD * b[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(b, _n, <span class="hljs-number">-1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = d; i &lt; _n; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> d[MAXN], e[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Deriv</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; l; i++) &#123;</span><br><span class="line">        b[i - <span class="hljs-number">1</span>] = <span class="hljs-number">1L</span>L * a[i] * i % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    b[l - <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Integ</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; l; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">1L</span>L * a[i - <span class="hljs-number">1</span>] * qpow(i, MOD - <span class="hljs-number">2</span>) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    b[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Ln</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span> * k; i++) d[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    inv(k, a, d);</span><br><span class="line">    Deriv(a, e, k);</span><br><span class="line">    <span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>, _n = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (_n &lt; (k &lt;&lt; <span class="hljs-number">1</span>)) _n &lt;&lt;= <span class="hljs-number">1</span>, l++;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | (((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)i &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(e, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    ntt(d, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        e[i] = <span class="hljs-number">1L</span>L * e[i] * d[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(e, _n, <span class="hljs-number">-1</span>);</span><br><span class="line">    Integ(e, b, k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> g[MAXN], h[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Exp</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (k == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">        b[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Exp(a, b, (k + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>, _n = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (_n &lt; (k &lt;&lt; <span class="hljs-number">1</span>)) _n &lt;&lt;= <span class="hljs-number">1</span>, l++;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | (((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)i &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; (k &lt;&lt; <span class="hljs-number">1</span>); i++) g[i] = h[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    Ln(b, g, k);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) h[i] = a[i];</span><br><span class="line">    ntt(b, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    ntt(h, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    ntt(g, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">1L</span>L * (<span class="hljs-number">1L</span>L - g[i] + h[i] + MOD) * b[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(b, _n, <span class="hljs-number">-1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = k; i &lt; _n; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> *c, <span class="hljs-keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> _n = <span class="hljs-number">1</span>, l = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (_n &lt; (n &lt;&lt; <span class="hljs-number">1</span>)) _n &lt;&lt;= <span class="hljs-number">1</span>, l++;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        rev[i] = (rev[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | (((<span class="hljs-number">1L</span>L * i) &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(a, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    ntt(b, _n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; _n; i++) &#123;</span><br><span class="line">        c[i] = <span class="hljs-number">1L</span>L * a[i] * b[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    ntt(c, _n, <span class="hljs-number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> fl, tt[MAXN], rr[MAXN], gg[MAXN], pp[MAXN], kk[MAXN], ss[MAXN], yy[MAXN], hh[MAXN], ww[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; (n &lt;&lt; <span class="hljs-number">2</span>); i++) &#123;</span><br><span class="line">        b[i] = c[i] = h[i] = g[i] = d[i] = e[i] = <span class="hljs-number">0</span>;</span><br><span class="line">        tt[i] = rr[i] = kk[i] = ss[i] = yy[i] = hh[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">void</span> _clr() &#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; (n &lt;&lt; <span class="hljs-number">2</span>); i++) &#123;</span><br><span class="line">        ww[i] = pp[i] = gg[i] = tt[i] = rr[i] = kk[i] = ss[i] = yy[i] = hh[i] = <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sqrt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    Ln(a, kk, d);</span><br><span class="line">    <span class="hljs-keyword">int</span> inv2 = qpow(<span class="hljs-number">2</span>, MOD - <span class="hljs-number">2</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        kk[i] = (<span class="hljs-number">1L</span>L * kk[i] * inv2) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    clear();</span><br><span class="line">    Exp(kk, b, d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    _clr();</span><br><span class="line">    Ln(a, kk, n);</span><br><span class="line">    clear();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        kk[i] = <span class="hljs-number">1L</span>L * kk[i] * k % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    Exp(kk, b, d);</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sin</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    _clr();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        tt[i] = <span class="hljs-number">1L</span>L * a[i] * I % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    Exp(tt, rr, d);</span><br><span class="line">    clear();</span><br><span class="line">    inv(d, rr, gg);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">1L</span>L * (rr[i] - gg[i] + MOD) * qpow(I * <span class="hljs-number">2</span>, MOD - <span class="hljs-number">2</span>) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cos</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    _clr();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        tt[i] = <span class="hljs-number">1L</span>L * a[i] * I % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    Exp(tt, rr, d);</span><br><span class="line">    clear();</span><br><span class="line">    inv(d, rr, gg);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        b[i] = <span class="hljs-number">1L</span>L * (rr[i] + gg[i]) * qpow(<span class="hljs-number">2</span>, MOD - <span class="hljs-number">2</span>) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">arcsin</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    _clr();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        ww[i] = gg[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    Deriv(a, tt, d);</span><br><span class="line">    mult(gg, ww, pp, d);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        pp[i] = (MOD - pp[i]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    pp[<span class="hljs-number">0</span>] = (pp[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>) % MOD;</span><br><span class="line">    <span class="hljs-built_in">sqrt</span>(pp, ss, d);</span><br><span class="line">    clear();</span><br><span class="line">    inv(d, ss, yy);</span><br><span class="line">    clear();</span><br><span class="line">    mult(tt, yy, hh, d);</span><br><span class="line">    clear();</span><br><span class="line">    Integ(hh, b, d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">arctan</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b, <span class="hljs-keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    clear();</span><br><span class="line">    _clr();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">        ww[i] = gg[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    Deriv(a, tt, d);</span><br><span class="line">    mult(gg, ww, pp, d);</span><br><span class="line">    pp[<span class="hljs-number">0</span>] = (<span class="hljs-number">1</span> + pp[<span class="hljs-number">0</span>]) % MOD;</span><br><span class="line">    clear();</span><br><span class="line">    inv(d, pp, yy);</span><br><span class="line">    clear();</span><br><span class="line">    mult(tt, yy, hh, d);</span><br><span class="line">    clear();</span><br><span class="line">    Integ(hh, b, d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    read(n), read(fl);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        read(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">/* Operator */</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        write(f[i]), <span class="hljs-built_in">putchar</span>(<span class="hljs-string">' '</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;下面是多项式的一些操作，包含了NTT，求逆，求 $\ln$，求导，求积分，求 $e^x$，开根，快速幂，三角函数和反三角函数。&lt;/p&gt;
&lt;p&gt;&lt;del&gt;多项式除法先咕着&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="多项式" scheme="http://yoursite.com/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/"/>
    
      <category term="NTT/FFT" scheme="http://yoursite.com/tags/NTT-FFT/"/>
    
  </entry>
  
  <entry>
    <title>-矩阵运算-矩阵乘法-分块- [洛谷 P5110]块速递推</title>
    <link href="http://yoursite.com/2019/07/03/91/"/>
    <id>http://yoursite.com/2019/07/03/91/</id>
    <published>2019-07-03T01:14:06.000Z</published>
    <updated>2019-07-03T01:24:04.764Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P5110" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>看着如此庞大的数据范围，$O(n \log n)$ 显然过不去。</p><p>所以做这题之前可以先去做一下<a href="https://loj.ac/problem/162" target="_blank" rel="noopener">快速幂 2</a>，学习一下光速幂是如何写的。</p><p>矩乘部分很简单，剩下的就是卡常了。</p><p>卡常技巧1：把 <code>long long</code> 换成 <code>int</code>。</p><p>卡常技巧2：循环展开</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="hljs-keyword">namespace</span> Mker &#123;</span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> SA, SB, SC;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%llu%llu%llu"</span>, &amp;SA, &amp;SB, &amp;SC);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> <span class="hljs-title">rand</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        SA ^= SA &lt;&lt; <span class="hljs-number">32</span>, SA ^= SA &gt;&gt; <span class="hljs-number">13</span>, SA ^= SA &lt;&lt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> t = SA;</span><br><span class="line">        SA = SB, SB = SC, SC ^= t ^ SA; <span class="hljs-keyword">return</span> SC;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Mat</span>&#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> a[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(a));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] =a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</span><br><span class="line">        a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-keyword">inline</span> Mat <span class="hljs-keyword">operator</span> * (Mat a, Mat b) &#123;</span><br><span class="line">    Mat c;</span><br><span class="line">    c.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = c.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = c.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = c.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</span><br><span class="line">    c.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = (c.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] * b.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] * b.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) % MOD;</span><br><span class="line">    c.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = (c.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] * b.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] * b.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]) % MOD;</span><br><span class="line">    c.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = (c.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] * b.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] * b.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) % MOD;</span><br><span class="line">    c.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = (c.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] * b.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + <span class="hljs-number">1L</span>L * a.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] * b.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]) % MOD;</span><br><span class="line">    <span class="hljs-keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> Mat <span class="hljs-title">qpow</span><span class="hljs-params">(Mat a, ull n)</span> </span>&#123;</span><br><span class="line">    Mat b;</span><br><span class="line">    b.init();</span><br><span class="line">    <span class="hljs-keyword">while</span> (n) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (n &amp; <span class="hljs-number">1</span>) b = b * a;</span><br><span class="line">        n &gt;&gt;= <span class="hljs-number">1</span>;</span><br><span class="line">        a = a * a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line">ull sq;</span><br><span class="line">Mat x1[<span class="hljs-number">50000</span>], x2[<span class="hljs-number">50000</span>], g;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> t;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;t);</span><br><span class="line">    Mker::init();</span><br><span class="line">    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;</span><br><span class="line">    Mat f, a, q;</span><br><span class="line">    a.clear(), q.clear();</span><br><span class="line">    a.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">233</span>, a.a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">666</span>;</span><br><span class="line">    a.a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">    x1[<span class="hljs-number">0</span>].init(), x2[<span class="hljs-number">0</span>].init();</span><br><span class="line">    sq = <span class="hljs-built_in">sqrt</span>(MOD - <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;</span><br><span class="line">    a.a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</span><br><span class="line">    g = qpow(a, sq);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= sq + <span class="hljs-number">1</span>; i++) &#123;</span><br><span class="line">        x1[i] = x1[i - <span class="hljs-number">1</span>] * a;</span><br><span class="line">        x2[i] = x2[i - <span class="hljs-number">1</span>] * g;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> k = (Mker::rand() - <span class="hljs-number">1</span>) % <span class="hljs-number">1000000006</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (k &lt;= <span class="hljs-number">1</span>) ans ^= k;</span><br><span class="line">        q = x1[k % sq] * x2[k / sq];</span><br><span class="line">        ans ^= q.a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P5110&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="分块" scheme="http://yoursite.com/tags/%E5%88%86%E5%9D%97/"/>
    
      <category term="矩阵乘法" scheme="http://yoursite.com/tags/%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>-贪心- [CF484A]Bits</title>
    <link href="http://yoursite.com/2019/06/30/90/"/>
    <id>http://yoursite.com/2019/06/30/90/</id>
    <published>2019-06-30T00:06:06.000Z</published>
    <updated>2019-06-30T01:04:20.302Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/CF484A" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>别以为这是个A题就很简单，我差点被坑了。。。。</p><p>这题就是每一位贪心的放 $1$，如果超过 $r$ 了就 <code>break</code> 。</p><p>话说一开始我还想用二分来着，后来发现答案并不单调。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="hljs-keyword">int</span> T;</span><br><span class="line">ll l, r, ans;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="hljs-keyword">while</span> (T--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%I64d%I64d"</span>, &amp;l, &amp;r);</span><br><span class="line">        ans = l;</span><br><span class="line">        <span class="hljs-keyword">for</span> (ll i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">62</span>; i++) &#123;</span><br><span class="line">            ll m = <span class="hljs-number">1L</span>L &lt;&lt; i;</span><br><span class="line">            ans |= m;</span><br><span class="line">            <span class="hljs-keyword">if</span> (ans &gt; r) &#123;</span><br><span class="line">                ans ^= m;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%I64d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/CF484A&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="贪心" scheme="http://yoursite.com/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="Codeforces" scheme="http://yoursite.com/tags/Codeforces/"/>
    
  </entry>
  
  <entry>
    <title>-数论-逆元- [洛谷 P4881]hby与tkw的基情</title>
    <link href="http://yoursite.com/2019/06/27/89/"/>
    <id>http://yoursite.com/2019/06/27/89/</id>
    <published>2019-06-27T09:38:35.000Z</published>
    <updated>2019-06-27T11:42:44.241Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P4881" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>先把题目转换为人话：</p><p>给定一个数字 $n$，求：</p><p>$$\sum^{\lfloor \frac{n+1}{2} \rfloor}_{i=1}(2 \times i-1) \times 26 ^ i​$$</p><p>对于求等差数列平方和等比数列的积的前 $n$ 项和我们可以用<strong>错位相减法</strong>。</p><p>设 $k=\lfloor \frac{n+1}{2} \rfloor, S_k=\sum^{\lfloor \frac{n+1}{2} \rfloor}_{i=1}(2 \times i-1) \times 26 ^ i​$。</p><p>则：$26 \times S_k=\sum^{\lfloor \frac{n+1}{2} \rfloor}_{i=1}(2 \times i-1) \times 26 ^ {i+1}​$</p><p>所以：</p><p>$$\begin{align}25 \times S_k &amp;= 26 \times S_k-S_k \\ &amp;= \sum^{\lfloor \frac{n+1}{2} \rfloor}<em>{i=1}(2 \times i-1) \times 26 ^ {i+1}-\sum^{k}</em>{i=1}(2 \times i-1) \times 26 ^ i \\ &amp;= (2\times k-1)\times 26^k -\frac{2 \times 26 \times(26^k-1)}{25}-26 \end{align}$$</p><p>再用快速幂和逆元随便瞎搞搞就可以了。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="hljs-keyword">int</span> T;</span><br><span class="line">ll n;</span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">qpow</span><span class="hljs-params">(ll a, ll b, ll p)</span> </span>&#123;</span><br><span class="line">    ll res = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>) res = (res * a) % p;</span><br><span class="line">        b &gt;&gt;= <span class="hljs-number">1</span>;</span><br><span class="line">        a = (a * a) % p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> res % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;T);</span><br><span class="line">    <span class="hljs-keyword">while</span> (T--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;n);</span><br><span class="line">        n = (n + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, (((<span class="hljs-number">2</span> * n - <span class="hljs-number">1</span>) * qpow(<span class="hljs-number">26</span>, n + <span class="hljs-number">1</span>, MOD) % MOD - <span class="hljs-number">26</span> * (qpow(<span class="hljs-number">26</span>, n, MOD) - <span class="hljs-number">1</span>) % MOD * qpow(<span class="hljs-number">25</span>, MOD - <span class="hljs-number">2</span>, MOD) * <span class="hljs-number">2</span> % MOD + <span class="hljs-number">26</span> + MOD) % MOD) * qpow(<span class="hljs-number">25</span>, MOD - <span class="hljs-number">2</span>, MOD) % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P4881&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="数论" scheme="http://yoursite.com/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="逆元" scheme="http://yoursite.com/tags/%E9%80%86%E5%85%83/"/>
    
  </entry>
  
  <entry>
    <title>-数论-欧拉定理- 有关无理数取余的一些想法</title>
    <link href="http://yoursite.com/2019/06/24/88/"/>
    <id>http://yoursite.com/2019/06/24/88/</id>
    <published>2019-06-24T03:12:52.000Z</published>
    <updated>2019-06-25T11:53:20.949Z</updated>
    
    <content type="html"><![CDATA[<p>我们知道针对有理数取余我们可以用费马小定理（欧拉定理）或者是扩展欧几里得求逆元得到。</p><p>但是现在，我们也可以根据（扩展）欧拉定理来进行无理数取余。</p><a id="more"></a><p>因为 $a^b \equiv a^{b \% \varphi(p)} \pmod p,\gcd(a,p)=1$。</p><p>所以可以把 $b$ 换为有理数，那么取余的对象就变成了根式。</p><p>但是这并不对所有的数据都适用，因为要满足 $\gcd(\varphi(p),b)=1$ ，其中 $b$ 为所要求逆元的数。 </p><p>尽管存在这个，但并没有说无理数取余是完全不可能，在特殊的数据下还是可以的，比如说 $\sqrt[3]{2} \equiv 3 \pmod 5$。</p><p><del>看，证明什么的都没有，多简洁</del></p><p>Update 2019.6.25</p><p>今天听说了一个叫二次剩余的东西，貌似我这个无理数取余没什么卵用了</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我们知道针对有理数取余我们可以用费马小定理（欧拉定理）或者是扩展欧几里得求逆元得到。&lt;/p&gt;
&lt;p&gt;但是现在，我们也可以根据（扩展）欧拉定理来进行无理数取余。&lt;/p&gt;
    
    </summary>
    
    
      <category term="数论" scheme="http://yoursite.com/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="欧拉定理" scheme="http://yoursite.com/tags/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>-树链剖分-线段树- [洛谷 P4116]Qtree3</title>
    <link href="http://yoursite.com/2019/06/05/87/"/>
    <id>http://yoursite.com/2019/06/05/87/</id>
    <published>2019-06-05T06:07:59.000Z</published>
    <updated>2019-06-05T06:18:57.354Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P4116" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这道题看到别人都用了很多高端的做法，但我太菜了，所以就只好用了一个线段树做法。</p><p>这里我用了一个树链剖分的性质：从根到一个节点的路径上的序号一定是单调递增的。</p><p>根据这个性质，我们可以有如下思路：</p><p>一开始，树上所有的点的点权都赋值成 $INF$ ，如果一个点被修改成了黑点，<strong>就把这个点赋值成这个点的编号</strong>，查询的时候做区间最小值就行了。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ls(x) ((x) &lt;&lt; 1)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rs(x) ((x) &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 0x7fffffff</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx;</span><br><span class="line">&#125;e[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Tp &amp;a, Tp &amp;b)</span> </span>&#123;</span><br><span class="line">    Tp t = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">max</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &gt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> head[MAXN], ecnt, n, m, x, y, dep[MAXN], si[MAXN], wt[MAXN], w[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> fa[MAXN], top[MAXN], son[MAXN], cnt, r = <span class="hljs-number">1</span>, id[MAXN], nid[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f]&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Segtree</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> a[MAXN], tmin[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        tmin[p] = min(tmin[ls(p)], tmin[rs(p)]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            tmin[p] = INF;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        build(l, m, ls(p));</span><br><span class="line">        build(m + <span class="hljs-number">1</span>, r, rs(p));</span><br><span class="line">        pd(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updated</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            tmin[p] = k;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) updated(x, l, m, ls(p), k);</span><br><span class="line">        <span class="hljs-keyword">else</span> updated(x, m + <span class="hljs-number">1</span>, r, rs(p), k);</span><br><span class="line">        pd(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">qmin</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> s = INF;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= l &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> tmin[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) s = min(qmin(x, y, l, m, ls(p)), s);</span><br><span class="line">        <span class="hljs-keyword">if</span> (y &gt; m) s = min(qmin(x, y, m + <span class="hljs-number">1</span>, r, rs(p)), s);</span><br><span class="line">        <span class="hljs-keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> (tmin[p] == INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) <span class="hljs-keyword">return</span> ask(x, l, m, ls(p));</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> ask(x, m + <span class="hljs-number">1</span>, r, rs(p));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;tr;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> deep)</span> </span>&#123;</span><br><span class="line">    dep[u] = deep;</span><br><span class="line">    fa[u] = f;</span><br><span class="line">    si[u] = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (to == f) <span class="hljs-keyword">continue</span>;</span><br><span class="line">        dfs1(to, u, deep + <span class="hljs-number">1</span>);</span><br><span class="line">        si[u] += si[to];</span><br><span class="line">        <span class="hljs-keyword">if</span> (si[to] &gt; si[son[u]]) son[u] = to;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> topf)</span> </span>&#123;</span><br><span class="line">    id[u] = ++cnt;</span><br><span class="line">    nid[cnt] = u;</span><br><span class="line">    top[u] = topf;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!son[u]) <span class="hljs-keyword">return</span>;</span><br><span class="line">    dfs2(son[u], topf);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (fa[u] == to || to == son[u]) <span class="hljs-keyword">continue</span>;</span><br><span class="line">        dfs2(to, to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">qrs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> ans = INF;</span><br><span class="line">    <span class="hljs-keyword">while</span> (top[x] != top[y]) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) swap(x, y);</span><br><span class="line">        ans = min(ans, tr.qmin(id[top[x]], id[x], <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>));</span><br><span class="line">        x = fa[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (dep[x] &gt; dep[y]) swap(x, y);</span><br><span class="line">    ans = min(tr.qmin(id[x], id[y], <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>), ans);</span><br><span class="line">    <span class="hljs-keyword">if</span> (ans == INF) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> nid[ans];</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">bool</span> ans = tr.ask(id[x], <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-comment">// puts("-----");</span></span><br><span class="line">    <span class="hljs-comment">// printf("%d\n", ans);</span></span><br><span class="line">    <span class="hljs-comment">// puts("-----");</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (ans) &#123;</span><br><span class="line">        tr.updated(id[x], <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, id[x]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        tr.updated(id[x], <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, INF);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">        add(x, y);</span><br><span class="line">        add(y, x);</span><br><span class="line">    &#125;</span><br><span class="line">    dfs1(r, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);</span><br><span class="line">    dfs2(r, r);</span><br><span class="line">    tr.build(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-comment">// for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// printf("%d ", id[i]);</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// puts("");</span></span><br><span class="line">    <span class="hljs-keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">        <span class="hljs-keyword">if</span> (!x) &#123;</span><br><span class="line">            update(y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, qrs(<span class="hljs-number">1</span>, y));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P4116&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="线段树" scheme="http://yoursite.com/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="树链剖分" scheme="http://yoursite.com/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>-图论-拓扑排序- [CF1131D]Gourmet choice</title>
    <link href="http://yoursite.com/2019/05/26/86/"/>
    <id>http://yoursite.com/2019/05/26/86/</id>
    <published>2019-05-26T09:27:30.000Z</published>
    <updated>2019-06-03T12:40:53.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/CF1131D" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><strong><em>并查集 + 拓扑排序</em></strong></p><p>那么我们该怎样用并查集和拓扑排序呢</p><p>思路很简单，把标有<code>=</code>的i和j放在同一个并查集内，然后根据题意连边，如果是<code>&gt;</code>，就这么连：i所在集合的标号 <code>-&gt;</code> j所在集合的标号，如果是<code>&gt;</code>那么就相反。当然，你也可以和我的意思相反，就是在赋值上有些麻烦。</p><p>连完边后，直接跑拓扑就可以了，别忘了在拓扑排序的时候给点赋值</p><p>也别忘了判断一下有没有环，如果有环，那么就不存在。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 2000100</span></span><br><span class="line"><span class="hljs-keyword">char</span> mp[<span class="hljs-number">1010</span>][<span class="hljs-number">1010</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, head[MAXN], ecnt, x, y, ent[MAXN], out[MAXN], rank[MAXN], p, deli[MAXN], fa[MAXN], ans, tot;</span><br><span class="line"><span class="hljs-keyword">bool</span> vis[MAXN], ifq[MAXN];</span><br><span class="line"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx;</span><br><span class="line">&#125;e[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f]&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (fa[x] == x) <span class="hljs-keyword">return</span> x;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> fa[x] = find(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">un</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x = find(x);</span><br><span class="line">    y = find(y);</span><br><span class="line">    <span class="hljs-keyword">if</span> (x == y) <span class="hljs-keyword">return</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (rank[x] &lt;= rank[y]) &#123;</span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="hljs-keyword">if</span> (rank[x] == rank[y]) &#123;</span><br><span class="line">            rank[x]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        fa[y] = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, mp[i] + <span class="hljs-number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        fa[i] = i;</span><br><span class="line">        rank[i] = <span class="hljs-number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mp[i][j] == <span class="hljs-string">'='</span>) &#123;</span><br><span class="line">                un(i, j + n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            x = find(j + n);</span><br><span class="line">            y = find(i);</span><br><span class="line">            <span class="hljs-keyword">if</span> (mp[i][j] == <span class="hljs-string">'&gt;'</span>) &#123;</span><br><span class="line">                add(x, y);</span><br><span class="line">                ent[y]++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mp[i][j] == <span class="hljs-string">'&lt;'</span>) &#123;</span><br><span class="line">                add(y, x);</span><br><span class="line">                ent[x]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tot = n + m;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        p = find(i);</span><br><span class="line">        <span class="hljs-keyword">if</span> (!ent[p] &amp;&amp; !ifq[p]) &#123;</span><br><span class="line">            q.push(p);</span><br><span class="line">            ifq[p] = <span class="hljs-number">1</span>;</span><br><span class="line">            deli[p] = <span class="hljs-number">1</span>;</span><br><span class="line">            deli[i] = <span class="hljs-number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[u] = <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (vis[to]) <span class="hljs-keyword">continue</span>;</span><br><span class="line">            ent[to]--;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!ent[to]) &#123;</span><br><span class="line">                deli[to] = deli[u] + <span class="hljs-number">1</span>;</span><br><span class="line">                q.push(to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(vis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!ent[find(i)]) ans++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// for (int i = 1; i &lt;= n + m; i++) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// printf("%d ", ent[find(i)]);</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// puts("");</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (tot != ans) &#123;</span><br><span class="line">        <span class="hljs-comment">// printf("%d %d\n", tot, ans);</span></span><br><span class="line">        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Yes"</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> p = find(i);</span><br><span class="line">        deli[i] = deli[p];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, deli[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">puts</span>(<span class="hljs-string">""</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = n + <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, deli[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/CF1131D&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="图论" scheme="http://yoursite.com/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="Codeforces" scheme="http://yoursite.com/tags/Codeforces/"/>
    
      <category term="拓扑排序" scheme="http://yoursite.com/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>-网络流- 对于网络流24题的题解索引</title>
    <link href="http://yoursite.com/2019/05/24/85/"/>
    <id>http://yoursite.com/2019/05/24/85/</id>
    <published>2019-05-24T11:25:01.000Z</published>
    <updated>2019-06-03T12:47:21.771Z</updated>
    
    <content type="html"><![CDATA[<p>这是所有的网络流24题，其中标记了我完成的和我没有完成的题</p><a id="more"></a><p>（PS:点击题解中的对勾可以传送到相应题的题解）</p><table><thead><tr><th style="text-align:center">题目</th><th style="text-align:center">AC</th><th style="text-align:center">题解</th></tr></thead><tbody><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2756" target="_blank" rel="noopener">飞行员配对方案问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/01/22/59/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2763" target="_blank" rel="noopener">试题库问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2764" target="_blank" rel="noopener">最小路径覆盖问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/01/22/60/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2754" target="_blank" rel="noopener">[CTSC1999]家园</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P1251" target="_blank" rel="noopener">餐巾计划问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2761" target="_blank" rel="noopener">软件补丁问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2762" target="_blank" rel="noopener">太空飞行计划问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2765" target="_blank" rel="noopener">魔术球问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2766" target="_blank" rel="noopener">最长不下降子序列问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2770" target="_blank" rel="noopener">航空路线问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2774" target="_blank" rel="noopener">方格取数问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/03/05/65/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P2775" target="_blank" rel="noopener">机器人路径规划问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P3254" target="_blank" rel="noopener">圆桌问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/05/24/84/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P3355" target="_blank" rel="noopener">骑士共存问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/05/24/83/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P3356" target="_blank" rel="noopener">火星探险问题 </a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"><a href="/2019/05/09/79/"><i class="fa fa-check" aria-hidden="true"></i></a></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P3357" target="_blank" rel="noopener">最长k可重线段集问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P3358" target="_blank" rel="noopener">最长k可重区间集问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4009" target="_blank" rel="noopener">汽车加油行驶问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4011" target="_blank" rel="noopener">孤岛营救问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4012" target="_blank" rel="noopener">深海机器人问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4013" target="_blank" rel="noopener">数字梯形问题</a></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4014" target="_blank" rel="noopener">分配问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4015" target="_blank" rel="noopener">运输问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="https://www.luogu.org/problemnew/show/P4016" target="_blank" rel="noopener">负载平衡问题</a></td><td style="text-align:center"><i class="fa fa-check" aria-hidden="true"></i></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是所有的网络流24题，其中标记了我完成的和我没有完成的题&lt;/p&gt;
    
    </summary>
    
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="网络流24题" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%8124%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-最大流-二分图- [洛谷 PP3254][网络流24题]圆桌问题</title>
    <link href="http://yoursite.com/2019/05/24/84/"/>
    <id>http://yoursite.com/2019/05/24/84/</id>
    <published>2019-05-24T11:09:55.000Z</published>
    <updated>2019-05-25T03:19:06.520Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3254" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>建立二分图和超级源汇，将每个源点连向每个单位的编号，容量为这个单位的人数，将每个圆桌的编号连向超级汇点，容量为这个圆桌所能容纳的人的数量，再在每个单位和每个圆桌分别相连，容量为 $1$。</p><p>最后跑最大流就可以了。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 1000002</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 2000000000</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">min</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx, w;</span><br><span class="line">&#125; e[MAXN];</span><br><span class="line"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, head[MAXN], ecnt = <span class="hljs-number">1</span>, x, y, z, r, k, dep[MAXN], cur[MAXN], cnt = <span class="hljs-number">1</span>, totp = <span class="hljs-number">0</span>, tot;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f], w&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;f, head[t], <span class="hljs-number">0</span>&#125;;</span><br><span class="line">    head[t] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(dep, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(dep));</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) q.pop();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + m + <span class="hljs-number">2</span>; i++) &#123;</span><br><span class="line">        cur[i] = head[i];</span><br><span class="line">    &#125;</span><br><span class="line">    dep[s] = <span class="hljs-number">0</span>;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[v]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (dep[to] &gt; INF &amp;&amp; e[i].w) &#123;</span><br><span class="line">                dep[to] = dep[v] + <span class="hljs-number">1</span>;</span><br><span class="line">                q.push(to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (dep[t] &lt; INF) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!l || u == t) <span class="hljs-keyword">return</span> l;</span><br><span class="line">    <span class="hljs-keyword">int</span> fl = <span class="hljs-number">0</span>, f;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = cur[u]; i; i = e[i].nx) &#123;</span><br><span class="line">        cur[u] = i;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (dep[to] == dep[u] + <span class="hljs-number">1</span> &amp;&amp; (f = dfs(to, t, min(l, e[i].w)))) &#123;</span><br><span class="line">            fl += f;</span><br><span class="line">            l -= f;</span><br><span class="line">            e[i ^ <span class="hljs-number">1</span>].w += f;</span><br><span class="line">            e[i].w -= f;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!l) <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> fl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Dinic</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> maxf = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (bfs(s, t)) &#123;</span><br><span class="line">        maxf += dfs(s, t , INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> maxf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> a[MAXN], b[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]);</span><br><span class="line">        totp += a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    r = n + m + <span class="hljs-number">2</span>;</span><br><span class="line">    k = n + m + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        add(r, i, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = n + <span class="hljs-number">1</span>; i &lt;= n + m; i++) &#123;</span><br><span class="line">        add(i, k, b[i - n]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = n + <span class="hljs-number">1</span>; j &lt;= n + m; j++) &#123;</span><br><span class="line">            add(i, j, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tot = Dinic(r, k);</span><br><span class="line">    <span class="hljs-keyword">if</span> (tot != totp) &#123;</span><br><span class="line">        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"0"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"1"</span>);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = head[i]; j; j = e[j].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[j].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (to != r &amp;&amp; e[j].w == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, e[j].v - n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-built_in">puts</span>(<span class="hljs-string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3254&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="二分图" scheme="http://yoursite.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="最大流" scheme="http://yoursite.com/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
      <category term="网络流24题" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%8124%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-二分图-最大流-最大匹配- [洛谷 P3355][网络流24题]骑士共存问题</title>
    <link href="http://yoursite.com/2019/05/24/83/"/>
    <id>http://yoursite.com/2019/05/24/83/</id>
    <published>2019-05-24T10:59:50.000Z</published>
    <updated>2019-05-25T03:22:25.363Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3355" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这道题我们先对图进行黑白染色，因为国际象棋中“马”的行走方式的特殊性，使得一个黑格对应八个白格，我们就可以根据黑白格的情况来建图。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100020</span></span><br><span class="line"><span class="hljs-keyword">namespace</span> STman &#123;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">(Tp &amp;x)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> C getchar()</span></span><br><span class="line">        Tp f = <span class="hljs-number">1</span>;x = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">char</span> k = C;</span><br><span class="line">        <span class="hljs-keyword">while</span> (k &lt; <span class="hljs-string">'0'</span> || k &gt; <span class="hljs-string">'9'</span>) &#123;<span class="hljs-keyword">if</span> (k == <span class="hljs-string">'-'</span>) f = <span class="hljs-number">-1</span>; k = C;&#125;</span><br><span class="line">        <span class="hljs-keyword">while</span> (k &gt;= <span class="hljs-string">'0'</span> &amp;&amp; k &lt;= <span class="hljs-string">'9'</span>) &#123;x = x * <span class="hljs-number">10</span> + k - <span class="hljs-string">'0'</span>; k = C;&#125;</span><br><span class="line">        x = x * f;</span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> C</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(Tp x)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'-'</span>) , x = -x;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">9</span>) write(x / <span class="hljs-number">10</span>);</span><br><span class="line">        <span class="hljs-built_in">putchar</span>(x % <span class="hljs-number">10</span> + <span class="hljs-string">'0'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> Tp <span class="hljs-title">max</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a &gt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Tp &amp;a, Tp &amp;b)</span> </span>&#123;</span><br><span class="line">        Tp t = a;</span><br><span class="line">        a = b;</span><br><span class="line">        b = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> Tp <span class="hljs-title">abs</span><span class="hljs-params">(Tp &amp;a)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -a;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sp</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-built_in">putchar</span>(<span class="hljs-number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">et</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-built_in">putchar</span>(<span class="hljs-number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> STman;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx;</span><br><span class="line">&#125;e[MAXN * <span class="hljs-number">10</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> head[MAXN], ecnt, n, m, tot, mtch[MAXN], ma, x, y;</span><br><span class="line"><span class="hljs-keyword">int</span> vis[MAXN], dx[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;, dy[] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>&#125;;</span><br><span class="line"><span class="hljs-keyword">bool</span> mp[<span class="hljs-number">302</span>][<span class="hljs-number">302</span>];</span><br><span class="line"><span class="hljs-keyword">char</span> s[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">z</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (i - <span class="hljs-number">1</span>) * n + j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f]&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Hungary</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[k]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (vis[to] != t) &#123;</span><br><span class="line">            vis[to] = t;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!mtch[to] || Hungary(mtch[to], t)) &#123;</span><br><span class="line">                mtch[to] = k;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    read(n), read(m);</span><br><span class="line">    <span class="hljs-built_in">memset</span>(mp, <span class="hljs-number">1</span>, <span class="hljs-keyword">sizeof</span>(mp));</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        read(x), read(y);</span><br><span class="line">        mp[x][y] = <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mp[i][j]) &#123;</span><br><span class="line">                tot++;</span><br><span class="line">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>; k &lt;= <span class="hljs-number">8</span>; k++) &#123;</span><br><span class="line">                    <span class="hljs-keyword">int</span> tx = i + dx[k], ty = j + dy[k];</span><br><span class="line">                    <span class="hljs-keyword">if</span> (tx &gt; n || tx &lt; <span class="hljs-number">1</span> || ty &gt; n || ty &lt; <span class="hljs-number">1</span> || !mp[tx][ty]) <span class="hljs-keyword">continue</span>;</span><br><span class="line">                    add(z(i, j), z(tx, ty));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mp[i][j]) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (Hungary(z(i, j), z(i, j))) ma++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    write(tot - (ma &gt;&gt; <span class="hljs-number">1</span>));</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3355&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="二分图" scheme="http://yoursite.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="最大匹配" scheme="http://yoursite.com/tags/%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="最大流" scheme="http://yoursite.com/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
      <category term="网络流24题" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%8124%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>-数论-线段树-逆元- [洛谷 P5142]区间方差</title>
    <link href="http://yoursite.com/2019/05/24/82/"/>
    <id>http://yoursite.com/2019/05/24/82/</id>
    <published>2019-05-24T09:36:07.000Z</published>
    <updated>2019-06-27T11:37:15.765Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P5142" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>一看到区间操作，我们就想到了线段树</p><p>但是我们要处理的是这个：</p><p>$$\sum^r_{i=l}\frac{(x_i-\overline{x})^2}{n}$$</p><p>该如何处理呢？</p><p>让我们来一步一步化简：</p><p>$$\begin{align} \sum^r_{i=l}\frac{(x_i-\overline{x})^2}{(r - l + 1)} &amp;= \frac{1}{(r - l + 1)}\sum^r_{i=l}(x_i-\overline{x})^2 \\ &amp;= \frac{1}{(r - l + 1)}\sum^r_{i=l}(x_i ^ 2-2x\overline{x}+\overline{x}^2) \\ &amp;= \frac{1}{(r - l + 1)}\sum^r_{i=l}x_i ^ 2-\frac{2\overline{x}}{(r - l + 1)}\sum^r_{i=l} x+\overline{x}^2 \end{align}​$$</p><p>然后我们就可以用线段树来维护两个操作：区间和和区间平方和。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ls(x) ((x) &lt;&lt; 1)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rs(x) ((x) &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Segtree</span> &#123;</span></span><br><span class="line">    ll a[MAXN], b[MAXN &lt;&lt; <span class="hljs-number">2</span>], sqr[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pd</span><span class="hljs-params">(ll p)</span> </span>&#123;</span><br><span class="line">        b[p] = b[ls(p)] + b[rs(p)];</span><br><span class="line">        sqr[p] = sqr[ls(p)] + sqr[rs(p)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll l, ll r, ll p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            b[p] = a[l];</span><br><span class="line">            sqr[p] = a[l] * a[l] % MOD;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ll m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        build(l, m, ls(p));</span><br><span class="line">        build(m + <span class="hljs-number">1</span>, r, rs(p));</span><br><span class="line">        pd(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change</span><span class="hljs-params">(ll x, ll l, ll r, ll p, ll k)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            b[p] = k;</span><br><span class="line">            sqr[p] = k * k % MOD;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ll m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) change(x, l, m, ls(p), k);</span><br><span class="line">        <span class="hljs-keyword">else</span> change(x, m + <span class="hljs-number">1</span>, r, rs(p), k);</span><br><span class="line">        pd(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function">ll <span class="hljs-title">asksum</span><span class="hljs-params">(ll x, ll y, ll l, ll r, ll p)</span> </span>&#123;</span><br><span class="line">        ll s = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= l &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> b[p];</span><br><span class="line">        &#125;</span><br><span class="line">        ll m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) s = (s + asksum(x, y, l, m, ls(p))) % MOD;</span><br><span class="line">        <span class="hljs-keyword">if</span> (y &gt; m) s = (s + asksum(x, y, m + <span class="hljs-number">1</span>, r, rs(p))) % MOD;</span><br><span class="line">        <span class="hljs-keyword">return</span> s % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function">ll <span class="hljs-title">asksqr</span><span class="hljs-params">(ll x, ll y, ll l, ll r, ll p)</span> </span>&#123;</span><br><span class="line">        ll s = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= l &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> sqr[p] % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ll m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) s = (s + asksqr(x, y, l, m, ls(p))) % MOD;</span><br><span class="line">        <span class="hljs-keyword">if</span> (y &gt; m) s = (s + asksqr(x, y, m + <span class="hljs-number">1</span>, r, rs(p))) % MOD;</span><br><span class="line">        <span class="hljs-keyword">return</span> s % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; tr;</span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">qpow</span><span class="hljs-params">(ll a, ll b, ll mod)</span> </span>&#123;</span><br><span class="line">    ll res = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (b) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>) res = (res * a) % mod;</span><br><span class="line">        b &gt;&gt;= <span class="hljs-number">1</span>;</span><br><span class="line">        a = (a * a) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> res % MOD;</span><br><span class="line">&#125;</span><br><span class="line">ll n, m, op, l, r, k, ny, ans, aver, ans2, p;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;tr.a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    tr.build(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld%lld"</span>, &amp;op, &amp;l, &amp;r);</span><br><span class="line">        <span class="hljs-keyword">if</span> (op == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            tr.change(l, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">                <span class="hljs-built_in">puts</span>(<span class="hljs-string">"0"</span>);</span><br><span class="line">                <span class="hljs-keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = <span class="hljs-number">0</span>;</span><br><span class="line">            aver = <span class="hljs-number">0</span>;</span><br><span class="line">            p = tr.asksum(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>) % MOD;</span><br><span class="line">            ny = qpow(r - l + <span class="hljs-number">1</span>, MOD - <span class="hljs-number">2</span>, MOD);</span><br><span class="line">            aver = (p % MOD * ny) % MOD;</span><br><span class="line">            ans += tr.asksqr(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);</span><br><span class="line">            ans2 = <span class="hljs-number">2</span> * (p % MOD * aver) % MOD;</span><br><span class="line">            ans -= ans2;</span><br><span class="line">            ans = (ans % MOD + MOD) % MOD;</span><br><span class="line">            ans += (r - l + <span class="hljs-number">1</span>) * (aver * aver % MOD) % MOD;</span><br><span class="line">            ans = (ans * ny) % MOD;</span><br><span class="line">            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P5142&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="数论" scheme="http://yoursite.com/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="线段树" scheme="http://yoursite.com/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="逆元" scheme="http://yoursite.com/tags/%E9%80%86%E5%85%83/"/>
    
  </entry>
  
  <entry>
    <title>-模拟退火- [洛谷 P3936]Coloring</title>
    <link href="http://yoursite.com/2019/05/21/81/"/>
    <id>http://yoursite.com/2019/05/21/81/</id>
    <published>2019-05-21T07:23:57.000Z</published>
    <updated>2019-05-26T09:32:34.272Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3936" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><del>真是goushi！</del></p><p>这道题让我看出了我是有多非。。。。</p><p>提交了整整6页啊，整整6页！<del>（不过我开小号提交不怕）</del></p><p>其实这道题本身没什么难的，就是随机交换两数，然后在进行判断进行退火的过程就好了。</p><p>为那些处在水深火热的提交中发几个我AC时的参数<del>（估计没啥用）</del>：</p><p>$T:1.0​$</p><p>$\Delta T:0.99998$</p><p>随机数种子：$19* * * *17$<del>这玩意我不说你们也知道</del></p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> GCC optimize(3)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> delta 0.99998</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> random(a, b) ((rand() % (b - a + 1)) + (a))</span></span><br><span class="line"><span class="hljs-keyword">int</span> n, m, c, p[MAXN], G[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>], tot, nowG[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>], _p, chG[<span class="hljs-number">100</span>][<span class="hljs-number">100</span>];</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(Tp &amp;a, Tp &amp;b)</span> </span>&#123;</span><br><span class="line">    Tp t = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Q</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (nowG[i][j] != nowG[i][j - <span class="hljs-number">1</span>]) ans++;</span><br><span class="line">            <span class="hljs-keyword">if</span> (nowG[i][j] != nowG[i - <span class="hljs-number">1</span>][j]) ans++;</span><br><span class="line">            <span class="hljs-keyword">if</span> (nowG[i][j] != nowG[i][j + <span class="hljs-number">1</span>]) ans++;</span><br><span class="line">            <span class="hljs-keyword">if</span> (nowG[i][j] != nowG[i + <span class="hljs-number">1</span>][j]) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">copy</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> flag)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                chG[i][j] = nowG[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            G[i][j] = chG[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SA</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span> t = <span class="hljs-number">1.0</span>;</span><br><span class="line">    _p = tot;</span><br><span class="line">    <span class="hljs-keyword">while</span> (t &gt; <span class="hljs-number">1e-14</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> x1 = random(<span class="hljs-number">1</span>, n);</span><br><span class="line">        <span class="hljs-keyword">int</span> y1 = random(<span class="hljs-number">1</span>, m);</span><br><span class="line">        <span class="hljs-keyword">int</span> x2 = random(<span class="hljs-number">1</span>, n);</span><br><span class="line">        <span class="hljs-keyword">int</span> y2 = random(<span class="hljs-number">1</span>, m);</span><br><span class="line">        <span class="hljs-keyword">if</span> (nowG[x1][y1] == nowG[x2][y2]) <span class="hljs-keyword">continue</span>;</span><br><span class="line">        <span class="hljs-built_in">std</span>::swap(nowG[x1][y1], nowG[x2][y2]);</span><br><span class="line">        <span class="hljs-keyword">int</span> now = Q();</span><br><span class="line">        <span class="hljs-keyword">int</span> dt = now - _p;</span><br><span class="line">        <span class="hljs-keyword">if</span> (dt &lt; <span class="hljs-number">0</span> || (<span class="hljs-built_in">exp</span>(-dt * <span class="hljs-number">1.0</span> / t) * RAND_MAX &gt; ((rand() % <span class="hljs-number">1000000</span>) / <span class="hljs-number">1000000.0</span>))) &#123;</span><br><span class="line">            copy(<span class="hljs-number">1</span>);</span><br><span class="line">            _p = now;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-built_in">std</span>::swap(nowG[x1][y1], nowG[x2][y2]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (_p &lt;= tot) &#123;</span><br><span class="line">            tot = _p;</span><br><span class="line">            copy(<span class="hljs-number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        t *= delta;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    srand(<span class="hljs-number">19260817</span>);</span><br><span class="line">    <span class="hljs-comment">// srand(rand() * rand());</span></span><br><span class="line">    <span class="hljs-comment">// srand(rand());</span></span><br><span class="line">    <span class="hljs-comment">// srand(rand());</span></span><br><span class="line">    <span class="hljs-comment">// srand(rand());</span></span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;c);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= c; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> col = rand() % c + <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">while</span> (!p[col]) col = rand() % c + <span class="hljs-number">1</span>;</span><br><span class="line">            G[i][j] = col;</span><br><span class="line">            nowG[i][j] = col;</span><br><span class="line">            p[col]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tot = Q();</span><br><span class="line">    _p = tot;</span><br><span class="line">    SA();</span><br><span class="line">    SA();</span><br><span class="line">    SA();</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, G[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-built_in">puts</span>(<span class="hljs-string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3936&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="模拟退火" scheme="http://yoursite.com/tags/%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-最大流-二分图-强连通分量- [洛谷 P3731][HAOI2017]新型城市化</title>
    <link href="http://yoursite.com/2019/05/13/80/"/>
    <id>http://yoursite.com/2019/05/13/80/</id>
    <published>2019-05-13T10:53:20.000Z</published>
    <updated>2019-05-25T03:22:25.357Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3731" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><del>这道题太技巧了</del></p><p>用人话说这道题：求出二分图最大匹配的必须边</p><p><del>于是这道题就简单了一半</del></p><p>先按照题意建好二分图，然后在用Dinic跑二分图最大匹配。</p><p>对于每一条边 $(u,v)$，如果这条边满流，那么就连新边 $v -&gt; u$，否则，连 $u -&gt; v$。</p><p>存在这样一个结论：如果边 $(x,y)$ 在最大匹配中，则 $x,y$ 不在同一强连通分量内<del>（我不会证明）</del>。</p><p>所以在残量网络上跑Tarjan就行了。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 1000010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 2000000000</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx, w;</span><br><span class="line">&#125;e[MAXN &lt;&lt; <span class="hljs-number">2</span>], _e[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">E</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> x, y;</span><br><span class="line">&#125;a[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> _head[MAXN], head[MAXN], ecnt = <span class="hljs-number">1</span>, _ecnt, n, m, col[MAXN], dep[MAXN], cur[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> dfn[MAXN], low[MAXN], tim, st[MAXN], top, num, in[MAXN], r, k, cnt;</span><br><span class="line"><span class="hljs-keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(E x, E y)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> x.x &lt; y.x || (x.x == y.x &amp;&amp; x.y &lt; y.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">min</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f], w&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;f, head[t], <span class="hljs-number">0</span>&#125;;</span><br><span class="line">    head[t] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">void</span> _add(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t) &#123;</span><br><span class="line">    _e[++_ecnt] = (Edge) &#123;t, _head[f], <span class="hljs-number">0</span>&#125;;</span><br><span class="line">    _head[f] = _ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(dep, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(dep));</span><br><span class="line">    dep[s] = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= k; i++) &#123;</span><br><span class="line">        cur[i] = head[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (dep[to] &gt; INF &amp;&amp; e[i].w) &#123;</span><br><span class="line">                dep[to] = dep[u] + <span class="hljs-number">1</span>;</span><br><span class="line">                q.push(to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> dep[t] &lt; INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!l || s == t) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">int</span> fl = <span class="hljs-number">0</span>, f;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = cur[s]; i; i = e[i].nx) &#123;</span><br><span class="line">        cur[s] = i;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (dep[to] == dep[s] + <span class="hljs-number">1</span> &amp;&amp; (f = dfs(to, t, min(l, e[i].w)))) &#123;</span><br><span class="line">            fl += f;</span><br><span class="line">            l -= f;</span><br><span class="line">            e[i].w -= f;</span><br><span class="line">            e[i ^ <span class="hljs-number">1</span>].w += f;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!l) <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> fl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Dinic</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> maxf = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (bfs(s, t)) &#123;</span><br><span class="line">        maxf += dfs(s, t, INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> maxf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u] = low[u] = ++tim;</span><br><span class="line">    st[++top] = u;</span><br><span class="line">    vis[u] = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = _head[u]; i; i = _e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = _e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            tarjan(v);</span><br><span class="line">            low[u] = min(low[u], low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (vis[v]) low[u] = min(low[u], dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (dfn[u] == low[u]) &#123;</span><br><span class="line">        num++;</span><br><span class="line">        <span class="hljs-keyword">int</span> v;</span><br><span class="line">        <span class="hljs-keyword">do</span> &#123;</span><br><span class="line">            v = st[top--];</span><br><span class="line">            vis[v] = <span class="hljs-number">0</span>;</span><br><span class="line">            in[v] = num;</span><br><span class="line">        &#125; <span class="hljs-keyword">while</span> (u != v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfscol</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> cr)</span> </span>&#123;</span><br><span class="line">    col[x] = cr;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = _head[x]; i; i = _e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = _e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!col[to]) &#123;</span><br><span class="line">            dfscol(to, <span class="hljs-number">3</span> - cr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    r = n + <span class="hljs-number">1</span>;</span><br><span class="line">    k = r + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;a[i].x, &amp;a[i].y);</span><br><span class="line">        _add(a[i].x, a[i].y);</span><br><span class="line">        _add(a[i].y, a[i].x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!col[i]) dfscol(i, <span class="hljs-number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (col[i] == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            add(r, i, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (col[i] == <span class="hljs-number">2</span>) &#123;</span><br><span class="line">            add(i, k, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(_head, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(_head));</span><br><span class="line">    _ecnt = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(_e, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(_e));</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (col[a[i].x] == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            add(a[i].x, a[i].y, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (col[a[i].y] == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            add(a[i].y, a[i].x, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">int</span> tot = Dinic(r, k);</span><br><span class="line">    <span class="hljs-comment">// for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// if (col[i] == 1) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// for (int j = head[i]; j; j = e[j].nx) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// if (!e[j].w &amp;&amp; e[j].v != r) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// printf("%d -&gt; %d\n", i, e[j].v);</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[r]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!e[i].w) &#123;</span><br><span class="line">            _add(to, r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (e[i].w) &#123;</span><br><span class="line">            _add(r, to);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = head[to]; j; j = e[j].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> v = e[j].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (v == r) <span class="hljs-keyword">continue</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (e[j].w) &#123;</span><br><span class="line">                _add(to, v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                _add(v, to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[k]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-comment">// printf("%d -- %d --&gt; %d\n", k, e[i].w, to);</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (e[i].w) &#123;</span><br><span class="line">            _add(k, to);</span><br><span class="line">            <span class="hljs-comment">// printf("%d -&gt; %d\n", to, k);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!e[i].w) &#123;</span><br><span class="line">            _add(to, k);</span><br><span class="line">            <span class="hljs-comment">// printf("%d -&gt; %d\n", k, to);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n + <span class="hljs-number">2</span>; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!dfn[i]) tarjan(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(a));</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (col[i] == <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = head[i]; j; j = e[j].nx) &#123;</span><br><span class="line">                <span class="hljs-keyword">int</span> v = e[j].v;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == r) <span class="hljs-keyword">continue</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!e[j].w) &#123;</span><br><span class="line">                    a[++cnt].x = i;</span><br><span class="line">                    a[cnt].y = v;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (a[cnt].x &gt; a[cnt].y) <span class="hljs-built_in">std</span>::swap(a[cnt].x, a[cnt].y);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tot = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">// for (int i = 1; i &lt;= n; i++) &#123;</span></span><br><span class="line">    <span class="hljs-comment">// printf("%d ", in[i]);</span></span><br><span class="line">    <span class="hljs-comment">// &#125;</span></span><br><span class="line">    <span class="hljs-comment">// puts("");</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (in[a[i].x] != in[a[i].y]) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[i].x &gt; a[i].y) <span class="hljs-built_in">std</span>::swap(a[i].x, a[i].y);</span><br><span class="line">            tot++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">std</span>::sort(a + <span class="hljs-number">1</span>, a + <span class="hljs-number">1</span> + cnt, cmp);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, tot);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (in[a[i].x] != in[a[i].y]) &#123;</span><br><span class="line">            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d %d\n"</span>, a[i].x, a[i].y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3731&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="二分图" scheme="http://yoursite.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="最大流" scheme="http://yoursite.com/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
      <category term="强连通分量" scheme="http://yoursite.com/tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-费用流- [洛谷 P3356][网络流24题]火星探险问题</title>
    <link href="http://yoursite.com/2019/05/09/79/"/>
    <id>http://yoursite.com/2019/05/09/79/</id>
    <published>2019-05-09T09:46:05.000Z</published>
    <updated>2019-05-26T09:32:39.996Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3356" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这道题其实和<a href="https://www.luogu.org/problemnew/show/P2045" target="_blank" rel="noopener">这道题</a>比较类似，只是多了有些方格不能走的的条件，所以我们就直接不建那些方格的边，其他模型和那道题一样，建完之后再跑费用流就行了。</p><p><del>网络流24题最毒瘤之处莫过于输出方案</del></p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 1000010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 2000000000</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx, w, c;</span><br><span class="line">&#125;e[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> head[MAXN], b[MAXN], ecnt = <span class="hljs-number">1</span>, nc, n, m, x, y, z;</span><br><span class="line"><span class="hljs-keyword">int</span> pre[MAXN], maxf, minc, dis[MAXN], la[MAXN], flow[MAXN], r, k, tot;</span><br><span class="line"><span class="hljs-keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f], w, c&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;f, head[t], <span class="hljs-number">0</span>, -c&#125;;</span><br><span class="line">    head[t] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(dis, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(dis));</span><br><span class="line">    <span class="hljs-built_in">memset</span>(flow, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(flow));</span><br><span class="line">    <span class="hljs-built_in">memset</span>(vis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vis));</span><br><span class="line">    pre[t] = <span class="hljs-number">-1</span>;</span><br><span class="line">    dis[s] = <span class="hljs-number">0</span>;</span><br><span class="line">    vis[s] = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[v] = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[v]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> f = e[i].w;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (f &gt; <span class="hljs-number">0</span> &amp;&amp; dis[to] &gt; dis[v] + e[i].c) &#123;</span><br><span class="line">                dis[to] = dis[v] + e[i].c;</span><br><span class="line">                pre[to] = v;</span><br><span class="line">                la[to] = i;</span><br><span class="line">                flow[to] = min(flow[v], f);</span><br><span class="line">                <span class="hljs-keyword">if</span> (!vis[to]) &#123;</span><br><span class="line">                    vis[to] = <span class="hljs-number">1</span>;</span><br><span class="line">                    q.push(to);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> pre[t] != <span class="hljs-number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mcmf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">while</span> (spfa(s, t)) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = t;</span><br><span class="line">        maxf += flow[t];</span><br><span class="line">        minc += flow[t] * dis[t];</span><br><span class="line">        <span class="hljs-keyword">while</span> (v != s) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> k = la[v];</span><br><span class="line">            e[k].w -= flow[t];</span><br><span class="line">            e[k ^ <span class="hljs-number">1</span>].w += flow[t];</span><br><span class="line">            v = pre[v];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">g</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (i - <span class="hljs-number">1</span>) * m + j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> car, <span class="hljs-keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (u == g(n, m) + n * m) <span class="hljs-keyword">return</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">        <span class="hljs-keyword">if</span> (e[i ^ <span class="hljs-number">1</span>].w &amp;&amp; u &lt; to + n * m) &#123;</span><br><span class="line">            e[i ^ <span class="hljs-number">1</span>].w--;</span><br><span class="line">            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d %d\n"</span>, car, (n * m - (u - to)) == <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> dfs(car, to + n * m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;nc, &amp;m, &amp;n);</span><br><span class="line">    r = n * m * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;</span><br><span class="line">    k = r + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;x);</span><br><span class="line">            <span class="hljs-keyword">if</span> (x == <span class="hljs-number">1</span>) <span class="hljs-keyword">continue</span>;</span><br><span class="line">            add(g(i, j), g(i, j) + n * m, INF, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (x == <span class="hljs-number">2</span>) &#123;</span><br><span class="line">                add(g(i, j), g(i, j) + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">1</span>) add(g(i - <span class="hljs-number">1</span>, j) + n * m, g(i, j), INF, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">1</span>) add(g(i, j - <span class="hljs-number">1</span>) + n * m, g(i, j), INF, <span class="hljs-number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add(r, g(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), nc, <span class="hljs-number">0</span>);</span><br><span class="line">    add(g(n, m) + n * m, k, nc, <span class="hljs-number">0</span>);</span><br><span class="line">    mcmf(r, k);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= nc; i++) &#123;</span><br><span class="line">        dfs(i, g(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) + n * m);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3356&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="网络流24题" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%8124%E9%A2%98/"/>
    
      <category term="费用流" scheme="http://yoursite.com/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-费用流- [洛谷 P3965][TJOI2013]循环格</title>
    <link href="http://yoursite.com/2019/04/29/78/"/>
    <id>http://yoursite.com/2019/04/29/78/</id>
    <published>2019-04-29T08:34:23.000Z</published>
    <updated>2019-05-26T09:32:44.709Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P3965" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这道题我们可以先将其拆点，把每个点拆成 $x$ 和 $x’$，然后将源点连向每个 $x$ ，将每个 $x’$ 连向汇点，最后根据题目中的所给的方向连边，设一个点 $x$ 指向点 $y$，那么就把 $x$ 和 $y’$ 连一条流量为 $1$，费用为 $0$ 的边，在从这个点向其它 $3$ 个方向连一条流量为 $1$ 费用为 $1$ 的边，再跑最小费用最大流就可以了。</p><p><del>PS：<code>min</code> 和 <code>max</code> 函数写错进然还能过样例</del></p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 1001000</span></span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx, w, c;</span><br><span class="line">&#125;e[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> head[MAXN], ecnt = <span class="hljs-number">1</span>, n, m, x, y, dis[MAXN], flow[MAXN], pre[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> la[MAXN], maxf, minc, z, c, r, k, g[<span class="hljs-number">20</span>][<span class="hljs-number">20</span>], cnt;</span><br><span class="line"><span class="hljs-keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="hljs-keyword">char</span> a[<span class="hljs-number">20</span>][<span class="hljs-number">20</span>];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f], w, c&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;f, head[t], <span class="hljs-number">0</span>, -c&#125;;</span><br><span class="line">    head[t] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(dis, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(dis));</span><br><span class="line">    <span class="hljs-built_in">memset</span>(vis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="hljs-built_in">memset</span>(flow, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(flow));</span><br><span class="line">    pre[t] = <span class="hljs-number">-1</span>;</span><br><span class="line">    dis[s] = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    vis[s] = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[u] = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (dis[to] &gt; dis[u] + e[i].c &amp;&amp; e[i].w) &#123;</span><br><span class="line">                dis[to] = dis[u] + e[i].c;</span><br><span class="line">                pre[to] = u;</span><br><span class="line">                la[to] = i;</span><br><span class="line">                flow[to] = min(flow[u], e[i].w);</span><br><span class="line">                <span class="hljs-keyword">if</span> (!vis[to]) &#123;</span><br><span class="line">                    vis[to] = <span class="hljs-number">1</span>;</span><br><span class="line">                    q.push(to);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> pre[t] != <span class="hljs-number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mcmf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">while</span> (spfa(s, t)) &#123;</span><br><span class="line">        maxf += flow[t];</span><br><span class="line">        minc += flow[t] * dis[t];</span><br><span class="line">        <span class="hljs-keyword">int</span> v = t;</span><br><span class="line">        <span class="hljs-keyword">while</span> (v != s) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> k = la[v];</span><br><span class="line">            e[k].w -= flow[t];</span><br><span class="line">            e[k ^ <span class="hljs-number">1</span>].w += flow[t];</span><br><span class="line">            v = pre[v];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    r = <span class="hljs-number">2</span> * n * m + <span class="hljs-number">1</span>;</span><br><span class="line">    k = r + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cin</span> &gt;&gt; a[i][j];</span><br><span class="line">            g[i][j] = ++cnt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n * m; i++) &#123;</span><br><span class="line">        add(r, i, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">        add(i + n * m, k, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        g[<span class="hljs-number">0</span>][i] = g[n][i];</span><br><span class="line">        g[n + <span class="hljs-number">1</span>][i] = g[<span class="hljs-number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        g[i][<span class="hljs-number">0</span>] = g[i][m];</span><br><span class="line">        g[i][m + <span class="hljs-number">1</span>] = g[i][<span class="hljs-number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[i][j] == <span class="hljs-string">'U'</span>) add(g[i][j], g[i - <span class="hljs-number">1</span>][j] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">else</span> add(g[i][j], g[i - <span class="hljs-number">1</span>][j] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[i][j] == <span class="hljs-string">'D'</span>) add(g[i][j], g[i + <span class="hljs-number">1</span>][j] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">else</span> add(g[i][j], g[i + <span class="hljs-number">1</span>][j] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[i][j] == <span class="hljs-string">'L'</span>) add(g[i][j], g[i][j - <span class="hljs-number">1</span>] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">else</span> add(g[i][j], g[i][j - <span class="hljs-number">1</span>] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[i][j] == <span class="hljs-string">'R'</span>) add(g[i][j], g[i][j + <span class="hljs-number">1</span>] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">else</span> add(g[i][j], g[i][j + <span class="hljs-number">1</span>] + n * m, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// puts("OK");</span></span><br><span class="line">    mcmf(r, k);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, minc);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P3965&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="费用流" scheme="http://yoursite.com/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>-学习笔记-树套树- 树套树学习笔记</title>
    <link href="http://yoursite.com/2019/04/24/77/"/>
    <id>http://yoursite.com/2019/04/24/77/</id>
    <published>2019-04-24T00:35:32.000Z</published>
    <updated>2019-05-25T03:22:25.337Z</updated>
    
    <content type="html"><![CDATA[<p><del>我学了很酷很炫的算法，我失败了</del></p><a id="more"></a><p>其实各类树套树都差不多，在这里主要说线段树套平衡树</p><p>线段树套一个平衡树，就是在线段树里的每个节点都开一个平衡树来存储<strong>这个节点所表示区间</strong>里的所有的数（如图所示）。</p><p><img src="\img\sts.png" alt=""></p><p>因此，建树这样建：</p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">        insert(rt[p], a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l != r) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        build(l, m, ls(p));</span><br><span class="line">        build(m + <span class="hljs-number">1</span>, r, rs(p));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建树的时间复杂度为 $O(n \log ^ 2 n)$。</p><p>关于建树的时间复杂度让我们来分析一下：</p><p>首先，对于线段树的每一层，都有 $n$ 个数被插入，而平衡树的插入操作时间复杂度是 $O(\log n)$ 的，因此，线段树每层的时间复杂度为 $O(n \log n)$ 的，并且，线段树至多有 $\log n$ 层，所以总的建树时间复杂度为 $O(n \log ^ 2 n)$。</p><p>下面讲一下动态查询区间第K大。</p><p>这是最最常见的用法，其实现原理就是在这个区间里进行二分。</p><p>虽然动态查询第K大用树状数组+整体二分也能做，但是树套树可以<strong>强制在线</strong></p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">RgKth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> ql = <span class="hljs-number">0</span>, qr = <span class="hljs-number">100000000</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (ql &lt; qr) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (ql + qr + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (RgRk(x, y, <span class="hljs-number">1</span>, n, m, <span class="hljs-number">1</span>) &lt; k) &#123; <span class="hljs-comment">// 查询这个数在这个区间内的排名</span></span><br><span class="line">            ql = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> qr = m - <span class="hljs-number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> qr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此操作时间复杂度为 $O(n \log^3 n)$。</p><p>动态查询第K大还有一种常见的写法是树状数组套主席树，这种方法虽然时间复杂度小，但是空间复杂度较大，在这里不进行讲解<del>其实就是自己不会</del></p><p>动态查询第K大例题：</p><p><a href="https://www.luogu.org/problemnew/show/P2617" target="_blank" rel="noopener">Dynamic Rankings</a></p><p><a href="https://www.luogu.org/problemnew/show/P3332" target="_blank" rel="noopener">[ZJOI2013]K大数查询</a></p><p>线段树套平衡树板子题：<a href="https://www.luogu.org/problemnew/show/P3380" target="_blank" rel="noopener">【模板】二逼平衡树（树套树）</a></p><p>Code:</p><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 线段树套Treap</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 2000020</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 0x7fffffff</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ls(x) ((x) &lt;&lt; 1)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rs(x) ((x) &lt;&lt; 1 | 1)</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &gt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">min</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Treap</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> l, r;</span><br><span class="line">    <span class="hljs-keyword">int</span> val, dat;</span><br><span class="line">    <span class="hljs-keyword">int</span> cnt, size;</span><br><span class="line">&#125;a[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> tot, n, m;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">New</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    a[++tot].val = val;</span><br><span class="line">    a[tot].dat = rand();</span><br><span class="line">    a[tot].cnt = a[tot].size = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    a[p].size = a[a[p].l].size + a[a[p].r].size + a[p].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FindR</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// printf("%d %d %d\n", p, a[p].val, val);</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (p == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (val == a[p].val) <span class="hljs-keyword">return</span> a[a[p].l].size;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val &lt; a[p].val) <span class="hljs-keyword">return</span> FindR(a[p].l, val);</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> FindR(a[p].r, val) + a[a[p].l].size + a[p].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zig</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;p)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> q = a[p].l;</span><br><span class="line">    a[p].l = a[q].r, a[q].r = p, p = q;</span><br><span class="line">    update(a[p].r), update(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zag</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;p)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> q = a[p].r;</span><br><span class="line">    a[p].r = a[q].l, a[q].l = p, p = q;</span><br><span class="line">    update(a[p].l), update(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;p, <span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (p == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        p = New(val);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (val == a[p].val) &#123;</span><br><span class="line">        a[p].cnt++, update(p);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (val &lt; a[p].val) &#123;</span><br><span class="line">        insert(a[p].l, val);</span><br><span class="line">        <span class="hljs-keyword">if</span> (a[p].dat &lt; a[a[p].l].dat) zig(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        insert(a[p].r, val);</span><br><span class="line">        <span class="hljs-keyword">if</span> (a[p].dat &lt; a[a[p].r].dat) zag(p);</span><br><span class="line">    &#125;</span><br><span class="line">    update(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Pre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!p) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> -INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a[p].val &gt;= val) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Pre(a[p].l, val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> max(a[p].val, Pre(a[p].r, val));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Next</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!p) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a[p].val &lt;= val) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> Next(a[p].r, val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> min(a[p].val, Next(a[p].l, val));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;p, <span class="hljs-keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (p == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (val == a[p].val) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a[p].cnt &gt; <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            a[p].cnt--, update(p);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a[p].l || a[p].r) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (a[p].r == <span class="hljs-number">0</span> || a[a[p].l].dat &gt; a[a[p].r].dat)</span><br><span class="line">                zig(p), Remove(a[p].r, val);</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">                zag(p), Remove(a[p].l, val);</span><br><span class="line">            update(p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> p = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    val &lt; a[p].val ? Remove(a[p].l, val) : Remove(a[p].r, val);</span><br><span class="line">    update(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Segtree</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> a[MAXN], b[MAXN], rt[MAXN];</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">            insert(rt[p], a[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l != r) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">            build(l, m, ls(p));</span><br><span class="line">            build(m + <span class="hljs-number">1</span>, r, rs(p));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        Remove(rt[p], a[x]);</span><br><span class="line">        insert(rt[p], k);</span><br><span class="line">        <span class="hljs-keyword">if</span> (l == r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> (x &lt;= m) change(x, l, m, k, ls(p));</span><br><span class="line">        <span class="hljs-keyword">else</span> change(x, m + <span class="hljs-number">1</span>, r, k, rs(p));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">RgRk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt; y || r &lt; x) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">// printf("%d\n", p);</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt;= x &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> FindR(rt[p], k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> RgRk(x, y, l, m, k, ls(p)) + RgRk(x, y, m + <span class="hljs-number">1</span>, r, k, rs(p));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">RgKth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> ql = <span class="hljs-number">0</span>, qr = <span class="hljs-number">100000000</span>;</span><br><span class="line">        <span class="hljs-keyword">while</span> (ql &lt; qr) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> m = (ql + qr + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (RgRk(x, y, <span class="hljs-number">1</span>, n, m, <span class="hljs-number">1</span>) &lt; k) &#123;</span><br><span class="line">                ql = m;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span> qr = m - <span class="hljs-number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> qr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">RgPre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt; y || r &lt; x) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> -INF;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt;= x &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> Pre(rt[p], k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> max(RgPre(x, y, l, m, k, ls(p)), RgPre(x, y, m + <span class="hljs-number">1</span>, r, k, rs(p)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">RgNext</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt; y || r &lt; x) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> INF;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (l &gt;= x &amp;&amp; y &gt;= r) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> Next(rt[p], k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> min(RgNext(x, y, l, m, k, ls(p)), RgNext(x, y, m + <span class="hljs-number">1</span>, r, k, rs(p)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;tr;</span><br><span class="line"><span class="hljs-keyword">int</span> op, l, r, k;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    srand(time(<span class="hljs-literal">NULL</span>));</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;tr.a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    tr.build(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;op);</span><br><span class="line">        <span class="hljs-keyword">switch</span> (op) &#123;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: &#123;</span><br><span class="line">                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, tr.RgRk(l, r, <span class="hljs-number">1</span>, n, k, <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>);</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: &#123;</span><br><span class="line">                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, tr.RgKth(l, r, <span class="hljs-number">1</span>, n, k, <span class="hljs-number">1</span>));</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: &#123;</span><br><span class="line">                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;l, &amp;r);</span><br><span class="line">                tr.change(l, <span class="hljs-number">1</span>, n, r, <span class="hljs-number">1</span>);</span><br><span class="line">                tr.a[l] = r;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: &#123;</span><br><span class="line">                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, tr.RgPre(l, r, <span class="hljs-number">1</span>, n, k, <span class="hljs-number">1</span>));</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: &#123;</span><br><span class="line">                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, tr.RgNext(l, r, <span class="hljs-number">1</span>, n, k, <span class="hljs-number">1</span>));</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我又学了新的树套树，到时候再更。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;del&gt;我学了很酷很炫的算法，我失败了&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="学习笔记" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="树套树" scheme="http://yoursite.com/tags/%E6%A0%91%E5%A5%97%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>-网络流-费用流- [洛谷 P4329][COCI2006-2007#1] Bond</title>
    <link href="http://yoursite.com/2019/04/23/76/"/>
    <id>http://yoursite.com/2019/04/23/76/</id>
    <published>2019-04-23T13:47:47.000Z</published>
    <updated>2019-05-26T09:33:38.420Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P4329" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>首先，能够很容易看出来，这是个二分图最大权匹配的模型</p><p>但是唯一不同的是，求的是乘积而不是和</p><p>所以我们可以运用 $\log$ 的性质：$\log ab = \log a + \log b$ 来把这道题转换为和的形式</p><p>如果担心精度会炸，那就开 $\texttt{long double}$ </p><p>最后跑一遍费用流就行了</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> v, nx, fl;</span><br><span class="line">    <span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span> w;</span><br><span class="line">&#125;e[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, s, t, head[MAXN], ecnt = <span class="hljs-number">1</span>, flow[MAXN], maxf, la[MAXN], pre[MAXN], x, y, z, f;</span><br><span class="line"><span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span> dis[MAXN], minc, k;</span><br><span class="line"><span class="hljs-keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">queue</span> &lt;<span class="hljs-keyword">int</span>&gt; q;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> f, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> fl, <span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span> w)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;t, head[f], fl, w&#125;;</span><br><span class="line">    head[f] = ecnt;</span><br><span class="line">    e[++ecnt] = (Edge) &#123;f, head[t], <span class="hljs-number">0</span>, -w&#125;;</span><br><span class="line">    head[t] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span> * n + <span class="hljs-number">2</span>; i++) &#123;</span><br><span class="line">        dis[i] = <span class="hljs-number">9999999.9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(flow, <span class="hljs-number">0x7f</span>, <span class="hljs-keyword">sizeof</span>(flow));</span><br><span class="line">    <span class="hljs-built_in">memset</span>(vis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vis));</span><br><span class="line">    q.push(s);</span><br><span class="line">    dis[s] = <span class="hljs-number">0.0</span>;</span><br><span class="line">    vis[s] = <span class="hljs-number">1</span>;</span><br><span class="line">    pre[t] = <span class="hljs-number">-1</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[v] = <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[v]; i; i = e[i].nx) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> f = e[i].fl;</span><br><span class="line">            <span class="hljs-keyword">int</span> to = e[i].v;</span><br><span class="line">            <span class="hljs-keyword">if</span> (f &gt; <span class="hljs-number">0</span> &amp;&amp; dis[to] &gt; dis[v] + e[i].w) &#123;</span><br><span class="line">                dis[to] = dis[v] + e[i].w;</span><br><span class="line">                pre[to] = v;</span><br><span class="line">                la[to] = i;</span><br><span class="line">                flow[to] = min(flow[v], f);</span><br><span class="line">                <span class="hljs-keyword">if</span> (!vis[to]) &#123;</span><br><span class="line">                    vis[to] = <span class="hljs-number">1</span>;</span><br><span class="line">                    q.push(to);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> pre[t] != <span class="hljs-number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mcmf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">while</span> (spfa(s, t)) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> v = t;</span><br><span class="line">        minc += (<span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span>)flow[t] * dis[t];</span><br><span class="line">        <span class="hljs-keyword">while</span> (v != s) &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> k = la[v];</span><br><span class="line">            e[k].fl -= flow[t];</span><br><span class="line">            e[k ^ <span class="hljs-number">1</span>].fl += flow[t];</span><br><span class="line">            v = pre[v];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">    s = <span class="hljs-number">2</span> * n + <span class="hljs-number">1</span>;</span><br><span class="line">    t = s + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        add(s, i, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>);</span><br><span class="line">        add(i + n, t, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;x);</span><br><span class="line">            k = (<span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span>)x / <span class="hljs-number">100.0</span>;</span><br><span class="line">            k = log2(k);</span><br><span class="line">            add(i, j + n, <span class="hljs-number">1</span>, -k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mcmf(s, t);</span><br><span class="line">    <span class="hljs-keyword">if</span> (minc == <span class="hljs-number">0.00</span>) &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"0.00000000\n"</span>);</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.6f\n"</span>, <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, -minc) * <span class="hljs-number">100.0</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P4329&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="网络流" scheme="http://yoursite.com/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="费用流" scheme="http://yoursite.com/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>-数论-莫比乌斯反演-容斥- [SP26017]GCDMAT - GCD OF MATRIX</title>
    <link href="http://yoursite.com/2019/04/18/75/"/>
    <id>http://yoursite.com/2019/04/18/75/</id>
    <published>2019-04-18T00:20:07.000Z</published>
    <updated>2019-05-26T09:33:06.003Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/SP26017" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>其实如果这道题没有容斥的操作就是这样：</p><p>$$\sum_{i = 1}^n \sum_{j = 1}^m \gcd(i, j)$$</p><p>然后我们可以推一下：</p><p>$$\sum_{i = 1}^n \sum_{j = 1}^m \gcd(i, j)​$$</p><p>$$\sum_{d = 1}^n \sum_{i = 1}^n \sum_{j = 1}^m [\gcd(i, j) == d] $$</p><p>$$\sum_{d = 1}^n \sum_{i = 1}^{\lfloor \frac{n}{d} \rfloor} \sum_{j = 1}^{\lfloor \frac{m}{d} \rfloor} [\gcd(i ,j) == 1] ​$$</p><p>$$\sum_{d = 1}^n \sum_{i = 1}^{\lfloor \frac{n}{d} \rfloor} \sum_{j = 1}^{\lfloor \frac{m}{d} \rfloor} \sum_{d | \gcd(i, j)} \mu(d)​$$</p><p>$$\sum_{d = 1}^n \sum_{a = 1}^n \mu(a) {\lfloor \frac{n}{ad} \rfloor}{\lfloor \frac{m}{ad} \rfloor}​$$</p><p>设 $T=ad​$</p><p>$$\sum_{T = 1}^n  {\lfloor \frac{n}{T} \rfloor}{\lfloor \frac{m}{T} \rfloor} \sum_{d | T} d \mu({\lfloor \frac{T}{d} \rfloor})​$$</p><p>因为 $\sum_{d | T} d \mu({\lfloor \frac{T}{d} \rfloor})​$ 这部分是狄利克雷卷积的形式，而 $id * \mu = \varphi​$</p><p>所以线性筛一遍欧拉函数再用整除分块就行了。</p><p>最后再用容斥<del>瞎搞搞</del>就可以了。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 500010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="hljs-keyword">int</span> p[MAXN + <span class="hljs-number">10</span>], tot, phi[MAXN + <span class="hljs-number">10</span>], T, g[MAXN + <span class="hljs-number">10</span>], answ;</span><br><span class="line"><span class="hljs-keyword">bool</span> chk[MAXN + <span class="hljs-number">10</span>];</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">min</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &lt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Tp&gt;</span><br><span class="line"><span class="hljs-function">Tp <span class="hljs-title">max</span><span class="hljs-params">(Tp a, Tp b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (a &gt; b) <span class="hljs-keyword">return</span> a;</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sieve</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    phi[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">    chk[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt;= MAXN; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!chk[i]) &#123;</span><br><span class="line">            p[++tot] = i;</span><br><span class="line">            phi[i] = i - <span class="hljs-number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= tot &amp;&amp; i * p[j] &lt;= MAXN; j++) &#123;</span><br><span class="line">            chk[i * p[j]] = <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!(i % p[j])) &#123;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i * p[j]] = phi[i] * phi[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= MAXN; i++) &#123;</span><br><span class="line">        g[i] = (g[i - <span class="hljs-number">1</span>] + phi[i]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> n = min(x, y);</span><br><span class="line">    <span class="hljs-keyword">int</span> m = max(x, y);</span><br><span class="line">    ll ans = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>, r; l &lt;= n; l = r + <span class="hljs-number">1</span>) &#123;</span><br><span class="line">        r = min(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (((n / l) % MOD * (m / l) % MOD) % MOD) * ((g[r] - g[l - <span class="hljs-number">1</span>] + MOD) % MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> (ans % MOD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> a, b, c, d, n, m;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    sieve();</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;T);</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">while</span> (T--) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld%lld%lld"</span>, &amp;a, &amp;b, &amp;c, &amp;d);</span><br><span class="line">        answ = (sum(c, d) + sum(a - <span class="hljs-number">1</span>, b - <span class="hljs-number">1</span>) - sum(c, b - <span class="hljs-number">1</span>) - sum(d, a - <span class="hljs-number">1</span>) + <span class="hljs-number">2</span> * MOD) % MOD;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, answ % MOD);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/SP26017&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="数论" scheme="http://yoursite.com/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="容斥" scheme="http://yoursite.com/tags/%E5%AE%B9%E6%96%A5/"/>
    
      <category term="莫比乌斯反演" scheme="http://yoursite.com/tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/"/>
    
      <category term="SPOJ" scheme="http://yoursite.com/tags/SPOJ/"/>
    
  </entry>
  
  <entry>
    <title>-整体二分-树状数组- [洛谷 P2617]Dynamic Rankings</title>
    <link href="http://yoursite.com/2019/04/15/74/"/>
    <id>http://yoursite.com/2019/04/15/74/</id>
    <published>2019-04-15T08:59:17.000Z</published>
    <updated>2019-05-25T03:22:25.345Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P2617" target="_blank" rel="noopener">Link</a></p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这题我们用整体二分。</p><a id="more"></a><p>为什么不用主席树套树状数组呢？<del>最主要的原因就是我不会。</del>因为主席树再套一个树状数组空间开销有些大，故不用主席树套树状数组<del>虽然我写的整体二分空间占用也小不到那里去</del></p><p>我们只需要把修改操作拆成删除、赋值两个操作就可以了，剩下的就是普通的整体二分查第K大了。</p><p>而且别忘了用树状数组维护修改操作。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 200010</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INF 1000000000</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">rec</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> op, x, y, z;</span><br><span class="line">&#125; q[MAXN &lt;&lt; <span class="hljs-number">2</span>], lq[MAXN &lt;&lt; <span class="hljs-number">2</span>], rq[MAXN &lt;&lt; <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, t, c[MAXN], ans[MAXN], id, a[MAXN];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (; x; x -= x &amp; -x) y += c[x];</span><br><span class="line">    <span class="hljs-keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (; x &lt;= n; x += x &amp; -x) c[x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> lval, <span class="hljs-keyword">int</span> rval, <span class="hljs-keyword">int</span> st, <span class="hljs-keyword">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (st &gt; ed) <span class="hljs-keyword">return</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (lval == rval) &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = st; i &lt;= ed; i++) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (q[i].op &gt; <span class="hljs-number">0</span>) ans[q[i].op] = lval;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">int</span> mid = (lval + rval) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> lt = <span class="hljs-number">0</span>, rt = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = st; i &lt;= ed; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (q[i].op == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (q[i].y &lt;= mid) change(q[i].x, <span class="hljs-number">1</span>), lq[++lt] = q[i];</span><br><span class="line">            <span class="hljs-keyword">else</span> rq[++rt] = q[i];</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="hljs-keyword">if</span> (q[i].op == <span class="hljs-number">-1</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (q[i].y &lt;= mid) change(q[i].x, <span class="hljs-number">-1</span>), lq[++lt] = q[i];</span><br><span class="line">            <span class="hljs-keyword">else</span> rq[++rt] = q[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (q[i].op &gt; <span class="hljs-number">0</span>)&#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> cnt = ask(q[i].y) - ask(q[i].x - <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (cnt &gt;= q[i].z) lq[++lt] = q[i];</span><br><span class="line">            <span class="hljs-keyword">else</span> q[i].z -= cnt, rq[++rt] = q[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = ed; i &gt;= st; i--) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (q[i].op == <span class="hljs-number">0</span> &amp;&amp; q[i].y &lt;= mid) change(q[i].x, <span class="hljs-number">-1</span>);</span><br><span class="line">        <span class="hljs-keyword">if</span> (q[i].op == <span class="hljs-number">-1</span> &amp;&amp; q[i].y &lt;= mid) change(q[i].x, <span class="hljs-number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= lt; i++) q[st + i - <span class="hljs-number">1</span>] = lq[i];</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= rt; i++) q[st + lt + i - <span class="hljs-number">1</span>] = rq[i];</span><br><span class="line">    solve(lval, mid, st, st + lt - <span class="hljs-number">1</span>);</span><br><span class="line">    solve(mid + <span class="hljs-number">1</span>, rval, st + lt, ed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">int</span> l, r, k;</span><br><span class="line"><span class="hljs-keyword">char</span> op[<span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> val;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;val);</span><br><span class="line">        a[i] = val;</span><br><span class="line">        q[++t].op = <span class="hljs-number">0</span>, q[t].x = i, q[t].y = val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%d%d"</span>, op, &amp;l, &amp;r);</span><br><span class="line">        <span class="hljs-keyword">if</span> (op[<span class="hljs-number">0</span>] == <span class="hljs-string">'Q'</span>) &#123;</span><br><span class="line">            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;k);</span><br><span class="line">            q[++t].op = ++id, q[t].x = l, q[t].y = r, q[t].z = k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            q[++t].op = <span class="hljs-number">-1</span>, q[t].x = l, q[t].y = a[l];</span><br><span class="line">            q[++t].op = <span class="hljs-number">0</span>, q[t].x = l, q[t].y = r;</span><br><span class="line">            a[l] = r;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    solve(-INF, INF, <span class="hljs-number">1</span>, t);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= id; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P2617&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Solution&quot;&gt;&lt;a href=&quot;#Solution&quot; class=&quot;headerlink&quot; title=&quot;Solution&quot;&gt;&lt;/a&gt;Solution&lt;/h2&gt;&lt;p&gt;这题我们用整体二分。&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="树状数组" scheme="http://yoursite.com/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="整体二分" scheme="http://yoursite.com/tags/%E6%95%B4%E4%BD%93%E4%BA%8C%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>-DP-贪心- [洛谷 5275]思路题(ak)</title>
    <link href="http://yoursite.com/2019/04/02/73/"/>
    <id>http://yoursite.com/2019/04/02/73/</id>
    <published>2019-04-02T09:47:08.000Z</published>
    <updated>2019-05-25T03:22:25.331Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p><a href="https://www.luogu.org/problemnew/show/P5275" target="_blank" rel="noopener">Link</a></p><a id="more"></a><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这道题的做法就是先按照a的大小排序，然后将此题转换为LIS问题，得用 $O(n \log n)​$ 的算法</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXN 100010</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">num</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> a, b, id;</span><br><span class="line">&#125;a[MAXN];</span><br><span class="line"><span class="hljs-keyword">int</span> n, d[MAXN], g[MAXN], top, k[MAXN], len;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(num a, num b)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> a.b &gt; b.b || ((a.b == b.b) &amp;&amp; a.a &lt; b.a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i].a);</span><br><span class="line">        a[i].id = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i].b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">std</span>::sort(a + <span class="hljs-number">1</span>, a + <span class="hljs-number">1</span> + n, cmp);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (a[i].a &gt;= d[top]) d[++top] = a[i].a, g[a[i].id] = top;</span><br><span class="line">        <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> j = <span class="hljs-built_in">std</span>::upper_bound(d + <span class="hljs-number">1</span>, d + <span class="hljs-number">1</span> + top, a[i].a) - d;</span><br><span class="line">            d[j] = a[i].a;</span><br><span class="line">            g[a[i].id] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, top);</span><br><span class="line">    len = top;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = n; i &gt;= <span class="hljs-number">1</span>; i--) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (g[a[i].id] == len)&#123;</span><br><span class="line">            k[len--] = a[i].id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (len &lt; <span class="hljs-number">1</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= top; i++) &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, k[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;题目描述&quot;&gt;&lt;a href=&quot;#题目描述&quot; class=&quot;headerlink&quot; title=&quot;题目描述&quot;&gt;&lt;/a&gt;题目描述&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.luogu.org/problemnew/show/P5275&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="洛谷" scheme="http://yoursite.com/tags/%E6%B4%9B%E8%B0%B7/"/>
    
      <category term="DP" scheme="http://yoursite.com/tags/DP/"/>
    
      <category term="贪心" scheme="http://yoursite.com/tags/%E8%B4%AA%E5%BF%83/"/>
    
  </entry>
  
</feed>
